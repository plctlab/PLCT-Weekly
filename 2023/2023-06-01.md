# PLCT 开源进展·第 46 期·2023 年 6 月 1 日

## 卷首语


## 本期亮点


## V8 RISC-V 移植工作
Port 上游更新
1. 4553932: [riscv][masm] Improve Instance Type Checks in Builtins::Call/Construct | https://chromium-review.googlesource.com/c/v8/v8/+/4553932
2. 4541408: [riscv] Unify pointer size | https://chromium-review.googlesource.com/c/v8/v8/+/4541408
3. 4543857: [riscv][static-roots]Port static-root | https://chromium-review.googlesource.com/c/v8/v8/+/4543857
4. 4525059: [riscv] Implement probe mmu mode | https://chromium-review.googlesource.com/c/v8/v8/+/4525059
5. 4541402: [riscv] Support acq/rel accesses and atomic accesses on tagged | https://chromium-review.googlesource.com/c/v8/v8/+/4541402
6. 4521076: [riscv]Enable caged heap | https://chromium-review.googlesource.com/c/v8/v8/+/4521076
7. 4505078: [riscv][builtins] Remake Api callback thunk wrappers calling convention | https://chromium-review.googlesource.com/c/v8/v8/+/4505078

## OpenJDK RV32GC 移植（史宁宁）

## OpenJDK 上游工作 (RV64 相关工作为主)

## OpenJDK 上游工作（张定立）

## OpenJDK 上游工作（曹贵）

## OpenJDK8 移植（章翔）

## Clang/LLVM RISC-V 移植工作

## gollvm 相关工作

## GNU Toolchain 相关工作

## Arch Linux for RISC-V

## Gentoo for RISC-V

## Nixpkgs for RISC-V

## Firefox (SpiderMonkey) RV64GCV 移植
1. https://phabricator.services.mozilla.com/D177449
2. https://phabricator.services.mozilla.com/D178616
3. https://bugzilla.mozilla.org/show_bug.cgi?id=1831496

## DynamoRIO RV64GC 移植

本月完善了 RV64 相关的基础设施，但还是不能运行任何程序。希望可以在 6 月份能将一个简单的 Hello World 运行起来。

以下是已合并到上游的 Pull Requests：

- ksco
    - [i#3544 RV64: Implemented a naive version of memfuncs](https://github.com/DynamoRIO/dynamorio/pull/6070)
    - [i#3544 RV64: Implemented more global assembly functions](https://github.com/DynamoRIO/dynamorio/pull/6064)
    - [i#3544 RV64: Implemented dr_call_on_clean_stack](https://github.com/DynamoRIO/dynamorio/pull/6062)
    - [i#3544 RV64: Some fixes and improvements to call_switch_stack](https://github.com/DynamoRIO/dynamorio/pull/6061)
    - [Fix function signature mismatch issue in RISC-V build](https://github.com/DynamoRIO/dynamorio/pull/6059)

以下是尚未合并到上游的 Pull Requests：

- ksco
    - [i#3544 RV64: Added an encoder and some fixes and improvments to the decoder](https://github.com/DynamoRIO/dynamorio/pull/6095)
    - [i#3544 RV64: Small improvments to some assembly functions](https://github.com/DynamoRIO/dynamorio/pull/6093)
    - [i#3544 RV64: Implement TLS functions](https://github.com/DynamoRIO/dynamorio/pull/6091)
    - [i#3544 RV64: Fixed dynamorio_syscall](https://github.com/DynamoRIO/dynamorio/pull/6090)
    - [i#3544 RV64: Fixed atomic functions and macros](https://github.com/DynamoRIO/dynamorio/pull/6089)
    - [i#3544 RV64: Added machine type support for ELF hdr verification](https://github.com/DynamoRIO/dynamorio/pull/6088)

## OpenCV RISC-V 移植

## LIBCXX Experimental/simd

## LuaJIT RV64G 移植

The focus this month belongs to JIT tracing: The trace number handling scheme had some tuning, whereas the exit number handler has undergone a thorough revamp.

Additionally, the interpreter has received some adjustments and the IR assembler has picked up many corrections.

- Interpreter
    - [Immediate optimizations](https://github.com/infiWang/LuaJIT/commit/d91b1d67eb893b1a85c778ae24cbbed3a30e0fad)
    - [Conditional select optimizations](https://github.com/infiWang/LuaJIT/commit/c4fea6f6413eff322d8a3b50aaae03662c875b79)

- JIT
    - [Correct scratch register list](https://github.com/infiWang/LuaJIT/commit/0daefb5c54f4adf03b6b9e3a1b5e9de8f44b62b7)
    - [Correct FUNCT3/FUNCT7 helper](https://github.com/infiWang/LuaJIT/commit/8c73efd7c83871b397a2173dff5d4fff35015826)
    - [Fix asm_href generic type hashing](https://github.com/infiWang/LuaJIT/commit/3ecd83582a63532c100b36c847c7e8b56a82ecf0)
    - [Fix asm_loop_fixup with none-inverted loop](https://github.com/infiWang/LuaJIT/commit/806f6fb30d47325b32778821dbdcb7d7426b40a7)
    - [Fix asm_tobit](https://github.com/infiWang/LuaJIT/commit/d6af8a0383ca63ecd0b46c2c9307e216159c9b09)
    - [Fix emit_roti](https://github.com/infiWang/LuaJIT/commit/227f5159da02dca1403eb24944a932ffd147c739)
    - [Fix emit_rot](https://github.com/infiWang/LuaJIT/commit/bfa2522f3d002b12b33106b3e124510e0a0d272f)
    - [Fix asm_bswap](https://github.com/infiWang/LuaJIT/commit/f84d08164ff1fdfeb776d920066544d65108ebc4)
    - [Initial exitno handling overhaul](https://github.com/infiWang/LuaJIT/commit/a1afe15899fe516ec5f9aaad5cff65b0297f2030)

## gem5

## Spike

## QEMU

## box64

本月我们继续完善 box64 RV64 JIT 后端 Dynarec，并且做了一些包装库的完善工作。
RV64 的后端终于变得可用了！发版在即。原作者也写了一篇文章简单回顾了这次移植的一些细节：[https://box86.org/2023/05/box64-and-risc-v/](https://box86.org/2023/05/box64-and-risc-v/)。

以下是已合并到上游的 Pull Requests：

- xctan
    - [Added F3 0F B8 POPCNT opcode and fixed LOCK CMPXCHG16B for ML2](https://github.com/ptitSeb/box64/pull/808)
    - [Fixed 66 0F 3A 0B ROUNDSD opcode](https://github.com/ptitSeb/box64/pull/765)
    - [Fixed 66 0F C6 SHUFPD opcode](https://github.com/ptitSeb/box64/pull/756)
    - [Added more opcodes](https://github.com/ptitSeb/box64/pull/751)

- ksco
    - [Added some wayland function wrappers](https://github.com/ptitSeb/box64/pull/807)
    - [Added more opcodes](https://github.com/ptitSeb/box64/pull/806)
    - [Fixed 66 0F CMOV opcodes](https://github.com/ptitSeb/box64/pull/804)
    - [Fixed 66 0F 38 2B PACKUSDW opcode](https://github.com/ptitSeb/box64/pull/802)
    - [Added 4 more libc dprintf wrappers](https://github.com/ptitSeb/box64/pull/798)
    - [Added vwprintf (for #793)](https://github.com/ptitSeb/box64/pull/794)
    - [Fixed stack align on varargs (for #789)](https://github.com/ptitSeb/box64/pull/790)
    - [Added 1 more symbol for libc (for #787)](https://github.com/ptitSeb/box64/pull/788)
    - [Added some missing fixes on GETEX](https://github.com/ptitSeb/box64/pull/785)
    - [Use the new x9 scratch register](https://github.com/ptitSeb/box64/pull/784)
    - [Forget mmx float reg only needed](https://github.com/ptitSeb/box64/pull/782)
    - [Added more 0F MMX opcodes and some fixes](https://github.com/ptitSeb/box64/pull/780)
    - [Added more opcodes and some fixes](https://github.com/ptitSeb/box64/pull/778)
    - [Remove redundant code](https://github.com/ptitSeb/box64/pull/777)
    - [Added 1 libx11 symbol for #758](https://github.com/ptitSeb/box64/pull/776)
    - [Added more opcodes and some fixes](https://github.com/ptitSeb/box64/pull/775)
    - [Added more opcodes and a small fix](https://github.com/ptitSeb/box64/pull/774)
    - [Used RunFunctionFmt for better sign-extend handling](https://github.com/ptitSeb/box64/pull/768)
    - [Fixed typos in (67) 88 MOV opcode](https://github.com/ptitSeb/box64/pull/767)
    - [Added more opcodes](https://github.com/ptitSeb/box64/pull/764)
    - [Added some mpg123 wrapped functions](https://github.com/ptitSeb/box64/pull/762)
    - [Added some AES opcodes](https://github.com/ptitSeb/box64/pull/761)
    - [Added more opcode for Unciv and some fixes](https://github.com/ptitSeb/box64/pull/759)
    - [Added more opcodes for Unciv](https://github.com/ptitSeb/box64/pull/757)
    - [Added more opcodes for Bastion and some fixes](https://github.com/ptitSeb/box64/pull/753)

## 其他面向 RISC-V International 的支持工作

### SAIL/ACT

## 在方舟开源编译器社区的工作

## MLIR

### 上游 RVV Dialect 提案


### Buddy Compiler


## Chisel/FIRRTL（CAAT 小队）

## coreboot for riscv

## openocd

## opensbi

## u-boot

## Aya Theorem Prover

## RISC-V 平台测试测评工作

## 测试开发相关工作
- Kernel CI环境搭建
  - 调通在LAVA中执行unmatched job，visionfive job
  - 修改kernelci-docker源码，部署kernelci前后端数据库
  - 调通lava job与kernelci的交互
  - 看kernelci后端代码，编写通过Kernel CI后端API创建lab以及lab token的python自动化脚本 https://github.com/jiewu-plct/kernel-ci/blob/main/creat-lab.py
  - 看kernelci前后端代码，修改kernelci前后端源码，解决kernelci界面无法查看log的问题
  - 解决在lava job中隐藏访问kernelci后端的token的问题
  - 调通用LAVA在unmatched中执行官方的ltp syscalls测试用例
  - 将如何搭建LAVA和KernelCI环境以及如何使用LAVA的内容整理成文档 https://github.com/jiewu-plct/kernel-ci
- 自动化脚本：
  - 根据需求修改抓取指定工程中所有软件包的revision，以及其在指定仓库指定架构下的构建结果的自动化脚本 https://github.com/isrc-cas/tarsier-oerv/tree/main/scripts/obs_pkgstatus

## 参考链接

- [PLCT 2022 年开源路线图](https://github.com/plctlab/PLCT-Weekly/blob/master/PLCT-Roadmap-2022.md)
- [PLCT 实验室的开放职位（社招）](https://github.com/plctlab/PLCT-Weekly/blob/master/Jobs.md)
- [PLCT 实验室的开放职位（实习生）](https://github.com/plctlab/weloveinterns/blob/master/open-internships.md)
- [PLCT 开源进展 (PLCT Weekly)](https://github.com/isrc-cas/PLCT-Weekly)
- [PLCT 公开报告幻灯片（选集）](https://github.com/isrc-cas/PLCT-Open-Reports)
